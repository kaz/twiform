<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>twiform</title>
</head>

<div id="targets"></div>
<textarea style="width: 100%; height: 10em;"></textarea>

<script>
	const changed = () => {
		const SNs = Array.from(document.querySelectorAll("input")).filter(c => c.checked).map(c => c.value);
		document.querySelector("textarea").value = JSON.stringify(SNs, null, "\t");
	};

	(async () => {
		const { ignore, effect: { purge_candidates: candidates } } = await fetch("./state.json").then(r => r.json());

		document.querySelector("#targets").innerHTML = candidates.map(user => {
			return `
					<h2>
						<label>
							<input onchange="changed()" type="checkbox" value="${user.screen_name}" ${ignore.some(sn => user.screen_name == sn) ? "checked" : ""}>
							<img src="https://res.cloudinary.com/narusejun/image/twitter_name/h_32/${user.screen_name}.jpg">
							${user.name}
						</label>
						(<a target="_blank" href="https://twitter.com/${user.screen_name}">@${user.screen_name}</a>)
					</h2>
					<pre style="background-color: #EEE; padding: 1em; white-space: pre-wrap;">${user.description}</pre>
				`;
		}).join("");

		changed();
	})();
</script>

</html>
